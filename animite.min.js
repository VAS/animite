/* Copyright 2013, Andrea Muttoni, Davide Ganito, www.vas.it */
function KeyFrame(e,t){this.comment=e||"",this.callbacks=t||[]}var Animite=function(e,t){var r=this,a=null,n=null,o=0,c=0,s=t.reels[0].frames
r.height=t.height,r.width=t.width,r.currentFrame=0,r.fps=t.fps||25,r.onEnterFrame=null,r.currentStep=0,r.keyFrames={},r.enabledTracks=[],r.preloaded={reels:[],frames:0,percent:0},r.totalFrames=function(){for(var e=0,r=0;r<t.reels.length;r++)e+=t.reels[r].frames
return e}(),e.style.height=t.height+"px",e.style.width=t.width+"px",e.style.backgroundRepeat="no-repeat"
for(var i=0;i<t.reels.length;i++){var m=t.reels[i]
m.cache=new Image,m.cache.src=m.path,m.cache.onload=function(){r.preloaded.reels.push(m.path),r.preloaded.frames+=m.frames,r.preloaded.percent+=m.frames/r.totalFrames*100}}Object.defineProperty(r,"now",{get:function(){return r.currentFrame/r.totalFrames*100},set:function(e){r.seek((e*r.totalFrames+.5)/100|0,r.currentStep||0)}}),r.seek=function(c,i){clearTimeout(a),r.currentStep=i,c=c||0,r.currentFrame=0>c?r.totalFrames-1+c%r.totalFrames:c%r.totalFrames,changedReel=n!==(r.currentFrame/s|0),n=r.currentFrame/s|0,o=r.currentFrame%s
var m=t.reels[n],l=o*t.width%m.width,p=t.height*(o*t.width/m.width|0)
changedReel&&(e.style.backgroundImage=m.cache?"url('"+m.cache.src+"')":"url('"+m.path+"')"),e.style.backgroundPosition="-"+l+"px -"+p+"px",r.onEnterFrame&&typeof r.onEnterFrame=="function"&&r.onEnterFrame.call(r)
var u,h=r.keyFrames[r.currentFrame]
for(trackName in h)if(u=h[trackName],r.enabledTracks.indexOf(trackName)>=0&&u&&u.callbacks&&u.callbacks instanceof Array)for(var f=0,F=u.callbacks.length;F>f;f++)u.callbacks[f].call(this,u)
i&&(a=setTimeout(function(){r.seek(c+i,i)},1e3/r.fps|0))},r.seek(0),r.play=function(e){r.seek(r.currentFrame,c?c:1),e&&e()},r.pause=function(e){c=r.currentStep,r.seek(r.currentFrame),e&&e()},r.stop=function(e){r.seek(0),e&&e()}}
Animite.prototype=Object.create(Object.prototype),Animite.prototype.addKeyFrame=function(e,t,r,a){this.keyFrames[e]||(this.keyFrames[e]={}),this.keyFrames[e][t]=new KeyFrame(r,[a])},Animite.prototype.frameToPos=function(e){return e/this.totalFrames*100},Animite.prototype.posToFrame=function(e){return e/100*this.totalFrames+.5|0},Animite.prototype.frameToTime=function(e){return e/this.fps},Animite.prototype.timeToFrame=function(e){return e*this.fps+.5|0},KeyFrame.prototype=Object.create(Object.prototype)